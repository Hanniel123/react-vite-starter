#!/bin/bash

# ================================
# Safe bash mode
# ================================
set -euo pipefail

# ================================
# Colors
# ================================
GREEN="\033[0;32m"
BLUE="\033[0;34m"
YELLOW="\033[1;33m"
RED="\033[0;31m"
NC="\033[0m"

log() {
  echo -e "${BLUE}[INFO]${NC} $1"
}

success() {
  echo -e "${GREEN}[SUCCESS]${NC} $1"
}

warn() {
  echo -e "${YELLOW}[WARNING]${NC} $1"
}

error() {
  echo -e "${RED}[ERROR]${NC} $1"
  exit 1
}

# ================================
# Check dependencies
# ================================
log "Checking required tools..."

command -v npm >/dev/null 2>&1 || error "npm is not installed."
command -v node >/dev/null 2>&1 || error "node is not installed."

success "All required tools are installed."

# ================================
# Project name
# ================================
read -rp "Enter project name (default: react-project): " project_name
project_name=${project_name:-react-project}

log "Project name set to: $project_name"

# ================================
# Create Vite project (React + TS)
# ================================
log "Creating Vite React + TypeScript project..."

npm create vite@latest "$project_name" -- --template react-ts

success "Vite project created."

cd "$project_name"

# ================================
# Install dependencies
# ================================
log "Installing npm dependencies..."

npm install

main_packages=(
  react-router-dom
  axios
  tailwindcss
  postcss
  autoprefixer
  react-icons
  lucide-react
  dayjs
  sass
)

log "Installing main packages: ${main_packages[*]}"
npm install "${main_packages[@]}"

success "Dependencies installed."

# ================================
# Tailwind init
# ================================
log "Initializing Tailwind CSS..."

# npx tailwindcss init -p

success "Tailwind initialized."

# ================================
# Project structure
# ================================
log "Creating feature-first architecture..."

cd src

main_directories=(app shared features pages)
mkdir -p "${main_directories[@]}"

# App
mkdir -p app/providers
touch app/router.tsx app/store.ts
mv App.tsx app/

# Shared
shared_folders=(ui hooks lib constants types)
for folder in "${shared_folders[@]}"; do
  mkdir -p "shared/$folder"
done

success "Project structure created."

# ================================
# Final message
# ================================
echo
success "Project setup completed successfully ðŸŽ‰"
echo
echo "Next steps:"
echo "  cd $project_name"
echo "  npm run dev"
echo
echo "To start a new feature, you can later run a command:"
echo "  react-feature <feature-name>"
